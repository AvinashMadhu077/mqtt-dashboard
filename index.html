<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aesthetic AQI Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
  :root {
    --bg-color: #0b1220;
    --card-bg: #1e293b;
    --text-main: #f8fafc;
  }

  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: var(--bg-color);
    color: var(--text-main);
    padding: 20px;
  }

  .container { max-width: 450px; margin: auto; }

  /* --- PM2.5 CARD (Your Image Style) --- */
  .pm-card {
    background: white;
    color: #1e293b;
    padding: 25px;
    border-radius: 28px;
    margin-bottom: 15px;
    overflow: hidden;
  }

  /* --- CO2 CLOUD BOX --- */
  .co2-card {
    background: #2d1b4e;
    height: 180px;
    border-radius: 24px;
    position: relative;
    overflow: hidden;
    margin-bottom: 15px;
    display: flex;
    flex-direction: column;
    padding: 20px;
  }

  .blob {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: linear-gradient(45deg, #a855f7, #6366f1);
    border-radius: 50%;
    filter: blur(20px);
    transition: all 1s ease;
    z-index: 1;
    opacity: 0.6;
  }

  /* --- HUMIDITY WAVE BOX --- */
  .hum-card {
    background: #1e293b;
    height: 180px;
    border-radius: 24px;
    position: relative;
    overflow: hidden;
    padding: 20px;
  }

  .wave-container {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%; height: 0%; /* Dynamic height */
    background: #0ea5e9;
    transition: height 1s ease;
  }

  .wave-svg {
    position: absolute;
    top: -20px;
    width: 200%;
    height: 25px;
    fill: #0ea5e9;
    animation: waveMove 4s linear infinite;
  }

  @keyframes waveMove {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
  }

  /* Labels */
  .card-label { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; z-index: 10; position: relative; opacity: 0.8; }
  .card-val { font-size: 2rem; font-weight: 800; z-index: 10; position: relative; }
</style>
</head>
<body>

<div class="container">
  
  <div class="pm-card">
    <div class="card-label" style="color:#64748b">Particulates</div>
    <div class="card-val"><span id="pmPercent">0</span>%</div>
    <div style="font-size:0.9rem; color:#475569">PM2.5 — <span id="pm25">0</span> µg/m³</div>
    <canvas id="particleCanvas" style="width:100%; height:100px; margin-top:10px"></canvas>
  </div>

  <div class="co2-card">
    <div class="card-label">CO₂ Concentration</div>
    <div class="card-val"><span id="co2">--</span> <small style="font-size:12px">ppm</small></div>
    <div id="co2Blob" class="blob" style="width: 50px; height: 50px;"></div>
  </div>

  <div class="hum-card">
    <div class="card-label">Humidity</div>
    <div class="card-val"><span id="hum">--</span>%</div>
    <div class="wave-container" id="humLevel">
        <svg class="wave-svg" viewBox="0 0 120 28"><path d="M0 15Q30 5 60 15t60 0v13H0z"/></svg>
    </div>
  </div>

</div>

<script>
/* --- PM2.5 PARTICLES --- */
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d');
let particles = [];
function drawPM(val) {
    canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;
    particles = [];
    for(let i=0; i<val*3; i++) {
        particles.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, s:Math.random()*3+1});
    }
}
function animPM() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#f39c12";
    particles.forEach(p => {
        ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
    });
    requestAnimationFrame(animPM);
}
animPM();

/* --- MQTT Logic --- */
const client = mqtt.connect("wss://cd29a7c955164a079ab779cab2f382d7.s1.eu.hivemq.cloud:8884/mqtt", {
    username: "adam1234", password: "Adam1234"
});

client.on("connect", () => client.subscribe("esp32/sensor"));

client.on("message", (topic, msg) => {
    const data = JSON.parse(msg.toString());
    
    // PM2.5 Update
    const pm = data.pm25 || 0;
    document.getElementById("pm25").innerText = pm;
    document.getElementById("pmPercent").innerText = Math.round((pm/15)*100);
    drawPM(pm);

    // CO2 Blob Update (Cloud grows and blurs)
    const co2 = data.co2 || 400;
    document.getElementById("co2").innerText = co2;
    const blobSize = Math.min(co2 / 4, 300);
    const blob = document.getElementById("co2Blob");
    blob.style.width = blobSize + 'px';
    blob.style.height = blobSize + 'px';
    blob.style.filter = `blur(${co2 / 50}px)`;

    // Humidity Wave Update (Level rises)
    const hum = data.hum || 0;
    document.getElementById("hum").innerText = hum;
    document.getElementById("humLevel").style.height = hum + '%';
});
</script>
</body>
</html>
