<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Air Quality Monitoring</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
:root{
  --bg:#0b1220;
  --card:#141c2f;
  --soft:#1e2a44;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --good:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:radial-gradient(circle at top,#111827,#020617);
  color:var(--text);
}

.container{
  max-width:430px;
  margin:auto;
  padding:18px;
}

/* ===== HEADER ===== */
.header{
  text-align:center;
  margin-bottom:20px;
}
.header h1{
  margin:0;
  font-size:28px;
  letter-spacing:.3px;
}
.header p{
  margin-top:6px;
  color:var(--muted);
  font-size:14px;
}

/* ===== CARDS ===== */
.card{
  background:linear-gradient(180deg,var(--card),#0f172a);
  border-radius:22px;
  padding:20px;
  margin-bottom:16px;
  box-shadow:0 20px 45px rgba(0,0,0,.45);
}

/* ===== ALERT BUTTON ===== */
#alertToggle{
  width:100%;
  border:none;
  border-radius:16px;
  padding:16px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  background:#374151;
  color:white;
  transition:.25s;
}

/* ===== PM2.5 HERO ===== */
.pm-hero{
  display:flex;
  justify-content:space-between;
  align-items:center;
  position:relative;
  overflow:hidden;
}

.pm-info small{
  color:var(--muted);
  font-size:13px;
}
.pm-info h2{
  margin:6px 0 0;
  font-size:34px;
  font-weight:800;
}

/* ===== PARTICLES ===== */
.pm-dots{
  position:relative;
  width:140px;
  height:90px;
}
.dot{
  position:absolute;
  border-radius:50%;
  background:#fbbf24;
}

/* ===== SENSOR ROWS ===== */
.sensor{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.sensor .label{
  color:var(--muted);
  font-size:14px;
}
.sensor .value{
  font-size:22px;
  font-weight:700;
}

/* ===== BADGE ===== */
.badge{
  padding:6px 14px;
  border-radius:999px;
  font-size:12px;
  font-weight:800;
}
.good{background:var(--good)}
.warn{background:var(--warn)}
.bad{background:var(--bad)}
</style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="header">
    <h1>Air Quality</h1>
    <p>Real-time Environmental Monitoring</p>
  </div>

  <!-- ALERT TOGGLE -->
  <div class="card">
    <button id="alertToggle">ðŸ”• Alerts OFF</button>
  </div>

  <!-- PM2.5 HERO -->
  <div class="card pm-hero">
    <div class="pm-info">
      <small>PARTICULATES Â· PM2.5</small>
      <h2><span id="pm25">--</span> Âµg/mÂ³</h2>
    </div>
    <div class="pm-dots" id="pmDots"></div>
  </div>

  <!-- SENSORS -->
  <div class="card sensor">
    <div>
      <div class="label">COâ‚‚</div>
      <div class="value"><span id="co2">--</span> ppm</div>
    </div>
    <div class="badge good">GOOD</div>
  </div>

  <div class="card sensor">
    <div>
      <div class="label">CO</div>
      <div class="value"><span id="co">--</span> ppm</div>
    </div>
    <div class="badge good">SAFE</div>
  </div>

  <div class="card sensor">
    <div>
      <div class="label">Temperature</div>
      <div class="value"><span id="temp">--</span> Â°C</div>
    </div>
    <div class="badge good">NORMAL</div>
  </div>

  <div class="card sensor">
    <div>
      <div class="label">Humidity</div>
      <div class="value"><span id="hum">--</span> %</div>
    </div>
    <div class="badge warn">MODERATE</div>
  </div>

  <div class="card sensor">
    <div>
      <div class="label">Overall AQI</div>
      <div class="value"><span id="aqi">--</span></div>
    </div>
    <div class="badge warn">MODERATE</div>
  </div>

</div>

<audio id="alertSound" src="alert.mp3" preload="auto"></audio>

<script>
/* ===== MQTT ===== */
const client = mqtt.connect(
  "wss://cd29a7c955164a079ab779cab2f382d7.s1.eu.hivemq.cloud:8884/mqtt",
  { username:"adam1234", password:"Adam1234" }
);

client.on("connect",()=>client.subscribe("esp32/sensor"));

/* ===== PARTICLES ===== */
function renderPMDots(pm){
  const box=document.getElementById("pmDots");
  box.innerHTML="";
  const count=Math.min(140,pm*2);
  for(let i=0;i<count;i++){
    const d=document.createElement("div");
    const s=Math.random()*6+2;
    d.className="dot";
    d.style.width=s+"px";
    d.style.height=s+"px";
    d.style.left=Math.random()*140+"px";
    d.style.top=Math.random()*90+"px";
    d.style.opacity=Math.random();
    box.appendChild(d);
  }
}

/* ===== ALERT SYSTEM ===== */
let alertsEnabled=false,alertPlaying=false;
const alertSound=document.getElementById("alertSound");
const btn=document.getElementById("alertToggle");

btn.onclick=()=>{
  alertsEnabled=!alertsEnabled;
  btn.textContent=alertsEnabled?"ðŸ”” Alerts ON":"ðŸ”• Alerts OFF";
  btn.style.background=alertsEnabled?"#22c55e":"#374151";
  if(alertsEnabled){
    alertSound.play().then(()=>{alertSound.pause();alertSound.currentTime=0});
  }else{
    alertSound.pause();alertPlaying=false;
  }
};

function checkDanger(d){
  if(!alertsEnabled) return;
  const danger=d.pm25>40||d.co>40||d.temp>40||d.co2>80||d.hum>80;
  if(danger&&!alertPlaying){
    alertPlaying=true;
    alertSound.loop=true;
    alertSound.play().catch(()=>{});
  }
  if(!danger&&alertPlaying){
    alertSound.pause();
    alertPlaying=false;
  }
}

/* ===== DATA ===== */
client.on("message",(t,m)=>{
  const d=JSON.parse(m.toString());
  pm25.textContent=d.pm25||0;
  co2.textContent=d.co2||0;
  co.textContent=d.co||0;
  temp.textContent=d.temp||0;
  hum.textContent=d.hum||0;
  aqi.textContent=Math.max(d.pm25||0,(d.co2||0)/10).toFixed(0);
  renderPMDots(d.pm25||0);
  checkDanger(d);
});
</script>

</body>
</html>
