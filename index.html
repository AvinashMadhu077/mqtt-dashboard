<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Air Quality Monitoring Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
:root {
  --bg: #0b1220;
  --card: #1b2435;
  --text: #e5e7eb;
  --muted: #9ca3af;
  --green: #22c55e;
  --yellow: #f59e0b;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
  background: radial-gradient(circle at top, #111827, #020617);
  color: var(--text);
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 16px;
}

.card {
  background: var(--card);
  border-radius: 18px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 15px 40px rgba(0,0,0,.4);
}

.title {
  text-align: center;
}

.title h1 {
  margin: 0;
  font-size: 26px;
}

.title p {
  color: var(--muted);
  margin-top: 6px;
}

.status-card {
  display: flex;
  align-items: center;
  gap: 10px;
}

.dot {
  width: 10px;
  height: 10px;
  background: var(--green);
  border-radius: 50%;
}

.sensor {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.value {
  font-size: 30px;
  font-weight: bold;
}

.unit {
  font-size: 18px;
  color: var(--muted);
}

.badge {
  padding: 6px 14px;
  border-radius: 999px;
  background: var(--green);
  font-size: 12px;
  font-weight: bold;
}

.badge.warn { background: var(--yellow); }

.sub {
  margin-top: 10px;
  color: var(--muted);
  font-size: 14px;
}

.raw {
  font-family: monospace;
  font-size: 13px;
  color: var(--muted);
  word-break: break-word;
}

footer {
  text-align: center;
  color: var(--muted);
  font-size: 13px;
  margin-top: 20px;
}
</style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="card title">
    <h1>Air Quality Monitoring Dashboard</h1>
    <p>Real-time Environmental Monitoring System</p>
  </div>

  <!-- MQTT STATUS -->
  <div class="card status-card">
    <div class="dot"></div>
    <div>
      <strong id="mqttStatus">Connecting to MQTT Broker</strong><br>
      <span class="sub">Last Update: <span id="lastUpdate">--:--:--</span></span>
    </div>
  </div>

  <!-- PM2.5 -->
  <div class="card sensor">
    <div>
      <strong>PM2.5</strong>
      <div class="value"><span id="pm25">--</span> <span class="unit">µg/m³</span></div>
      <div class="sub">Status: Excellent</div>
    </div>
    <div class="badge">GOOD</div>
  </div>

  <!-- CO2 -->
  <div class="card sensor">
    <div>
      <strong>CO₂</strong>
      <div class="value"><span id="co2">--</span> <span class="unit">ppm</span></div>
      <div class="sub">Status: Normal</div>
    </div>
    <div class="badge">GOOD</div>
  </div>

  <!-- CO -->
  <div class="card sensor">
    <div>
      <strong>CO</strong>
      <div class="value"><span id="co">--</span> <span class="unit">ppm</span></div>
      <div class="sub">Status: Safe</div>
    </div>
    <div class="badge">GOOD</div>
  </div>

  <!-- TEMPERATURE -->
  <div class="card sensor">
    <div>
      <strong>Temperature</strong>
      <div class="value"><span id="temp">--</span> <span class="unit">°C</span></div>
      <div class="sub">Status: Normal</div>
    </div>
    <div class="badge">COMFORTABLE</div>
  </div>

  <!-- HUMIDITY -->
  <div class="card sensor">
    <div>
      <strong>Humidity</strong>
      <div class="value"><span id="hum">--</span> <span class="unit">%</span></div>
      <div class="sub">Status: Comfortable</div>
    </div>
    <div class="badge">NORMAL</div>
  </div>

  <!-- AQI -->
  <div class="card sensor">
    <div>
      <strong>Overall AQI</strong>
      <div class="value"><span id="aqi">--</span> <span class="unit">Index</span></div>
      <div class="sub">Status: Excellent</div>
    </div>
    <div class="badge warn">MODERATE</div>
  </div>

  <!-- RAW DATA -->
  <div class="card">
    <strong>Raw Sensor Data Stream</strong>
    <div class="raw" id="raw">--</div>
  </div>

  <footer>
    © 2026 Air Quality Monitoring System | Powered by ESP32 & MQTT
  </footer>

</div>

<script>
const client = mqtt.connect(
  "wss://cd29a7c955164a079ab779cab2f382d7.s1.eu.hivemq.cloud:8884/mqtt",
  {
    username: "adam1234",
    password: "Adam1234",
    reconnectPeriod: 3000
  }
);

client.on("connect", () => {
  document.getElementById("mqttStatus").innerText = "Connected to MQTT Broker";
  client.subscribe("esp32/sensor");
});

client.on("message", (topic, msg) => {
  const data = JSON.parse(msg.toString());

  document.getElementById("pm25").innerText = data.pm25;
  document.getElementById("co2").innerText = data.co2;
  document.getElementById("co").innerText = data.co;
  document.getElementById("temp").innerText = data.temperature;
  document.getElementById("hum").innerText = data.humidity;
  document.getElementById("aqi").innerText = data.aqi;

  document.getElementById("raw").innerText = msg.toString();
  document.getElementById("lastUpdate").innerText =
    new Date().toLocaleTimeString();
});
</script>
</body>
</html>
